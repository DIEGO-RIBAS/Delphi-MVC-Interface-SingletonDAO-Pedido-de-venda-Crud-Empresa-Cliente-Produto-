unit uCliente.View;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Buttons, Vcl.ComCtrls, Vcl.StdCtrls,
  dxGDIPlusClasses, Vcl.ExtCtrls, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Datasnap.DBClient, FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Comp.DataSet, FireDAC.Comp.Client;

type
  TfrmClientes = class(TForm)
    Panel1: TPanel;
    Image1: TImage;
    Label1: TLabel;
    StatusBar1: TStatusBar;
    dsClientes: TDataSource;
    PageControl1: TPageControl;
    tsConsulta: TTabSheet;
    tsdados: TTabSheet;
    GroupBox1: TGroupBox;
    GridClientes: TDBGrid;
    SpeedButton1: TSpeedButton;
    mClientes: TFDMemTable;
    mClientesid: TIntegerField;
    mClientesNome: TStringField;
    mClientescidade: TStringField;
    mClientesuf: TStringField;
    Panel2: TPanel;
    SpeedButton2: TSpeedButton;
    SpeedButton3: TSpeedButton;
    GroupBox2: TGroupBox;
    edtCodCliente: TEdit;
    Label2: TLabel;
    edtNome: TEdit;
    Label3: TLabel;
    edtCidade: TEdit;
    Label4: TLabel;
    edtUF: TEdit;
    Label5: TLabel;
    btnExcluir: TSpeedButton;
    SpeedButton4: TSpeedButton;
    btnPrimeiro: TSpeedButton;
    btnAnterior: TSpeedButton;
    btnProximo: TSpeedButton;
    btnUltimo: TSpeedButton;
    SpeedButton5: TSpeedButton;
    procedure SpeedButton1Click(Sender: TObject);
    procedure SpeedButton2Click(Sender: TObject);
    procedure SpeedButton3Click(Sender: TObject);
    procedure SpeedButton4Click(Sender: TObject);
    procedure btnUltimoClick(Sender: TObject);
    procedure btnProximoClick(Sender: TObject);
    procedure btnAnteriorClick(Sender: TObject);
    procedure btnPrimeiroClick(Sender: TObject);
    procedure SpeedButton5Click(Sender: TObject);
  private
    { Private declarations }
    function ValidaCampos : Boolean;
    procedure limpar;
    procedure CarregadadosCliente;
  public
    { Public declarations }
  end;

var
  frmClientes: TfrmClientes;

implementation

  uses
    uCliente.Model;

{$R *.dfm}

procedure TfrmClientes.btnAnteriorClick(Sender: TObject);
begin
  if mClientes.IsEmpty then
    Exit;

  mClientes.Prior;

  if mClientesid.AsString = edtCodCliente.Text then
    Exit;

  CarregadadosCliente;
end;

procedure TfrmClientes.btnPrimeiroClick(Sender: TObject);
begin
  if mClientes.IsEmpty then
    Exit;

  mClientes.First;

  if mClientesid.AsString = edtCodCliente.Text then
    Exit;

  CarregadadosCliente;
end;

procedure TfrmClientes.btnProximoClick(Sender: TObject);
begin
  if mClientes.IsEmpty then
    Exit;

  mClientes.Next;

  if mClientesid.AsString = edtCodCliente.Text then
    Exit;

  CarregadadosCliente;
end;

procedure TfrmClientes.btnUltimoClick(Sender: TObject);
begin
  if mClientes.IsEmpty then
    Exit;

  mClientes.Last;

  if mClientesid.AsString = edtCodCliente.Text then
    Exit;

  CarregadadosCliente;
end;

procedure TfrmClientes.CarregadadosCliente;
begin
  edtCodCliente.Text := mClientesid.AsString;
  edtNome.Text       := mClientesNome.AsString;
  edtCidade.Text     := mClientescidade.AsString;
  edtUF.Text         := mClientesuf.AsString;
end;

procedure TfrmClientes.limpar;
begin
  edtCodCliente.Clear;
  edtNome.Clear;
  edtCidade.Clear;
  edtUF.Clear;
end;

procedure TfrmClientes.SpeedButton1Click(Sender: TObject);
begin
  TClienteModel
               .New
               .Listar(mClientes);
end;

procedure TfrmClientes.SpeedButton2Click(Sender: TObject);
begin
  Close;
end;

procedure TfrmClientes.SpeedButton3Click(Sender: TObject);
begin
  if ValidaCampos then
  begin
    if TClienteModel
                    .New
                    .id(StrToIntDef(edtCodCliente.Text,0))
                    .Nome(edtNome.Text)
                    .cidade(edtCidade.Text)
                    .uf(edtUF.Text)
                    .Gravar then
    begin
      Limpar;
      Application.MessageBox('Registro armazenado co sucesso !','Informação !',MB_ICONMASK);
    end;
  end;
end;

procedure TfrmClientes.SpeedButton4Click(Sender: TObject);
begin
  limpar;
end;

procedure TfrmClientes.SpeedButton5Click(Sender: TObject);
begin
  if mClientes.RecordCount > 0 then
  begin
    CarregadadosCliente;
    PageControl1.ActivePageIndex := 1;
  end;
end;

function TfrmClientes.ValidaCampos: Boolean;
begin
  Result := False;

  if edtNome.Text = '' then
  begin
    Application.MessageBox('Campo obrigatório não preenchido ','Atenção !',MB_ICONMASK);
    edtNome.SetFocus;
    Exit;
  end;

  Result := True;
end;

end.
